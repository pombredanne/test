_help = help


class Lazy(object):
    def __init__(self, fn):
        self._fn = fn
        self._obj = None

    def _load_lazy(self):
        if self._obj is None:
            self._obj = self._fn()
            assert self._obj is not None

    def __getattr__(self, name):
        self._load_lazy()
        return getattr(self._obj, name)

    def __dir__(self):
        self._load_lazy()
        return dir(self.__obj)

    def help(self):
        _help(self._obj)


class Autoloader(Lazy):
    def __init__(self, module_name):
        super(Autoloader, self).__init__(self._load_module)
        self.__module_name = module_name

    def _load_module(self):
        return __import__(self.__module_name)


def help(x):
    if isinstance(x, Autoloader):
        x._load_module()
        x.help()
    else:
        _help(x)

chainer = Autoloader('chainer')
cupy = Autoloader('cupy')
json = Autoloader('json')
np = Autoloader('numpy')
onnx = Autoloader('onnx')
os = Autoloader('os')
sys = Autoloader('sys')
threading = Autoloader('threading')
tf = Autoloader('tensorflow')
torch = Autoloader('torch')

F = Lazy(lambda: chainer.functions)
L = Lazy(lambda: chainer.links)
